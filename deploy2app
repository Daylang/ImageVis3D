if [ $# -ne 1 ]; then
  echo 1>&2 Usage: $0 Release/Debug
  exit 127
fi

TARGETPATH=Build/OSX/$1
TARGETAPP=ImageVis3D.app


if [ -d $TARGETPATH/$TARGETAPP ]; then
	echo Changing into Bin directory 
	cd $TARGETPATH
	
	echo Copying framework files

	if [ -d $TARGETAPP/Contents/Frameworks ]; then
          echo Using existing framework directory
	else
          echo Creating new framework directory
	  mkdir $TARGETAPP/Contents/Frameworks
	fi

        echo   Core
	if [ -d $TARGETAPP/Contents/Frameworks/QtCore.framework ]; then
		rm -rf $TARGETAPP/Contents/Frameworks/QtCore.framework
	fi
	cp -R /Library/Frameworks/QtCore.framework $TARGETAPP/Contents/Frameworks

        echo   GUI
	if [ -d $TARGETAPP/Contents/Frameworks/QtGui.framework ]; then
		rm -rf $TARGETAPP/Contents/Frameworks/QtGui.framework
	fi
	cp -R /Library/Frameworks/QtGui.framework  $TARGETAPP/Contents/Frameworks

        echo   QtOpenGL
	if [ -d $TARGETAPP/Contents/Frameworks/QtOpenGL.framework ]; then
		rm -rf $TARGETAPP/Contents/Frameworks/QtOpenGL.framework
	fi
	cp -R /Library/Frameworks/QtOpenGL.framework  $TARGETAPP/Contents/Frameworks


	echo Running install_name_tool 

	# set the identification names for the frameworks
	install_name_tool -id @executable_path/../Frameworks/QtCore.framework/Versions/4/QtCore $TARGETAPP/Contents/Frameworks/QtCore.framework/Versions/4/QtCore
	install_name_tool -id @executable_path/../Frameworks/QtGui.framework/Versions/4/QtGui $TARGETAPP/Contents/Frameworks/QtGui.framework/Versions/4/QtGui
	install_name_tool -id @executable_path/../Frameworks/QtOpenGL.framework/Versions/4/QtOpenGL $TARGETAPP/Contents/Frameworks/QtOpenGL.framework/Versions/4/QtOpenGL

	# change "pointers" to the frameworks
	install_name_tool -change QtCore.framework/Versions/4/QtCore @executable_path/../Frameworks/QtCore.framework/Versions/4/QtCore $TARGETAPP/Contents/MacOs/ImageVis3D
	install_name_tool -change QtGui.framework/Versions/4/QtGui @executable_path/../Frameworks/QtGui.framework/Versions/4/QtGui $TARGETAPP/Contents/MacOs/ImageVis3D
	install_name_tool -change QtOpenGL.framework/Versions/4/QtOpenGL @executable_path/../Frameworks/QtOpenGL.framework/Versions/4/QtOpenGL $TARGETAPP/Contents/MacOs/ImageVis3D
	
	# change "pointers" within the frameworks cross referencing to core
	install_name_tool -change QtCore.framework/Versions/4/QtCore @executable_path/../Frameworks/QtCore.framework/Versions/4/QtCore $TARGETAPP/Contents/Frameworks/QtGui.framework/Versions/4/QtGui
	install_name_tool -change QtCore.framework/Versions/4/QtCore @executable_path/../Frameworks/QtCore.framework/Versions/4/QtCore $TARGETAPP/Contents/Frameworks/QtOpenGL.framework/Versions/4/QtOpenGL
	install_name_tool -change QtGui.framework/Versions/4/QtGui @executable_path/../Frameworks/QtGui.framework/Versions/4/QtGui $TARGETAPP/Contents/Frameworks/QtOpenGL.framework/Versions/4/QtOpenGL

	echo Copying additional resources 


	echo Changing back to where we came from 
	cd ../../..
else
	echo $TARGETPATH/$TARGETAPP not found, build the application in xcode before running this script
fi
